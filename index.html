<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰‹å†™ç¬”è®°</title>
    <style>
        body { font-family: system-ui; max-width: 600px; margin: 40px auto; padding: 0 20px; }
        a { color: #0066cc; text-decoration: none; }
        a:hover { text-decoration: underline; }
        li { margin: 8px 0; }
        #back { margin-bottom: 20px; }
    </style>
</head>
<body>
    <h2>ğŸ“’ æ‰‹å†™ç¬”è®°</h2>
    <div id="back"></div>
    <ul id="list"><li>åŠ è½½ä¸­...</li></ul>

    <script>
        const REPO_URL = 'https://raw.githubusercontent.com/time2024/courses/main';
        const ignore = ['index.html', 'LICENSE', 'README.md', '.gitignore', 'files.json', '.github'];
        const path = new URLSearchParams(location.search).get('path') || '';
        
        if (path) {
            const parent = path.includes('/') ? '?path=' + path.substring(0, path.lastIndexOf('/')) : '?';
            document.getElementById('back').innerHTML = `<a href="${parent}">â¬… è¿”å›ä¸Šçº§</a>`;
        }

        fetch('files.json')
            .then(r => r.json())
            .then(allFiles => {
                const list = document.getElementById('list');
                list.innerHTML = '';
                
                // ç­›é€‰å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶
                const currentItems = [];
                const prefix = path ? path + '/' : '';
                
                allFiles.forEach(f => {
                    // è·³è¿‡å¿½ç•¥çš„æ–‡ä»¶
                    if (ignore.some(ig => f.name === ig || f.name.startsWith(ig + '/') || f.name.startsWith('.'))) return;
                    
                    // åŒ¹é…å½“å‰ç›®å½•
                    if (path === '') {
                        // æ ¹ç›®å½•ï¼šåªæ˜¾ç¤ºé¡¶çº§é¡¹ç›®
                        if (!f.name.includes('/')) {
                            currentItems.push({ name: f.name, type: f.type });
                        } else {
                            // æ·»åŠ é¡¶çº§æ–‡ä»¶å¤¹
                            const topFolder = f.name.split('/')[0];
                            if (!currentItems.find(i => i.name === topFolder)) {
                                currentItems.push({ name: topFolder, type: 'dir' });
                            }
                        }
                    } else {
                        // å­ç›®å½•
                        if (f.name.startsWith(prefix)) {
                            const rest = f.name.slice(prefix.length);
                            if (rest && !rest.includes('/')) {
                                currentItems.push({ name: rest, type: f.type, fullPath: f.name });
                            } else if (rest) {
                                const subFolder = rest.split('/')[0];
                                if (!currentItems.find(i => i.name === subFolder)) {
                                    currentItems.push({ name: subFolder, type: 'dir', fullPath: prefix + subFolder });
                                }
                            }
                        }
                    }
                });

                // è¿‡æ»¤å¹¶æ’åº
                const items = currentItems
                    .filter(f => !ignore.includes(f.name))
                    .sort((a, b) => {
                        if (a.type === 'dir' && b.type !== 'dir') return -1;
                        if (a.type !== 'dir' && b.type === 'dir') return 1;
                        return a.name.localeCompare(b.name, 'zh-CN', { numeric: true });
                    });

                if (items.length === 0) {
                    list.innerHTML = '<li>æš‚æ— å†…å®¹</li>';
                    return;
                }

                items.forEach(f => {
                    const li = document.createElement('li');
                    const fullPath = f.fullPath || f.name;
                    if (f.type === 'dir') {
                        li.innerHTML = `ğŸ“ <a href="?path=${fullPath}">${f.name}</a>`;
                    } else {
                        li.innerHTML = `ğŸ“„ <a href="${REPO_URL}/${fullPath}" target="_blank">${f.name}</a>`;
                    }
                    list.appendChild(li);
                });
            })
            .catch(() => {
                document.getElementById('list').innerHTML = '<li>åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°</li>';
            });
    </script>
</body>
</html>
